---
title: "Cleaning AQ"
author: "Nathan Khadaroo-McCheyne"
output: 
  html_document:
    theme: united
    df_print: paged
    highlight: tango
    toc: yes
    toc_depth: 3
    toc_float:
      collapsed: no
      smooth_scroll: no
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Installing packages:

```{r, message=FALSE}
library(tidyverse)
```


# AQ Data:

## Getting data:

For the air quality sensor data there are six data sets, three weeks of data for each location.

First reading in the data sets from Darley Avenue:

```{r ,message=FALSE, warning = FALSE}

url1 <- "https://raw.githubusercontent.com/OpenDataManchester/data/master/themes/Our%20Streets%20Chorlton/Air%20Quality/Darley%20Avenue%20(44)/Darley_Avenue_(44)_None_01-02-2021_07-02-2021.csv"

url2 <- "https://raw.githubusercontent.com/OpenDataManchester/data/master/themes/Our%20Streets%20Chorlton/Air%20Quality/Darley%20Avenue%20(44)/Darley_Avenue_(44)_None_07-02-2021_14-02-2021.csv"

url3 <- "https://raw.githubusercontent.com/OpenDataManchester/data/master/themes/Our%20Streets%20Chorlton/Air%20Quality/Darley%20Avenue%20(44)/Darley_Avenue_(44)_None_15-02-2021_21-02-2021.csv"

darley_avn <- read_csv(url(url1)) %>%
  bind_rows(read_csv(url2)) %>%
  bind_rows(read_csv(url3)) %>%
  janitor::clean_names()

names(darley_avn)

head(darley_avn)
```

Then cleaning the data a little. The column names are very long and location-specific so I have renamed them to align with the meta data in the [github readme](https://github.com/OpenDataManchester/data/tree/master/themes/Our%20Streets%20Chorlton/Air%20Quality), and added a column for location and coordinates:

```{r ,message=FALSE}

darley_cln <- darley_avn %>%
  rename(Temperature = darley_avenue_44_temp_c_slot_b,
         Humidity = darley_avenue_44_humidity_percent_rh_slot_b,
         NO2 = darley_avenue_44_no2_ug_m3_slot_b,
         O3 = darley_avenue_44_o3_ug_m3_slot_b,
         NO = darley_avenue_44_no_ug_m3_slot_b,
         PM1 = darley_avenue_44_pm1_ug_m3_slot_b,
         PM2.5 = darley_avenue_44_pm2_5_ug_m3_slot_b,
         PM10 = darley_avenue_44_pm10_ug_m3_slot_b,
         Ambient_temp = darley_avenue_44_ambient_temp_c_slot_b,
         Ambient_humidity = darley_avenue_44_ambient_humidity_percent_rh_slot_b,
         Ambient_pressure = darley_avenue_44_ambient_pressure_h_pa_slot_b,
         Timestamp = timestamp_utc) %>%
  mutate(Location = "Darley Avenue",
         Longitude = -2.267525,
         Latitude = 53.427108) %>%
  select(-timestamp_uts,
         -timestamp_local)

head(darley_cln)
```

Then reading the data from the Four Banks junction:

```{r ,message=FALSE, warning = FALSE}

url1 <- "https://raw.githubusercontent.com/OpenDataManchester/data/master/themes/Our%20Streets%20Chorlton/Air%20Quality/Four%20Banks%20(163)/Four_Banks_-_Barlow_Moor_Road_(163)_None_01-02-2021_07-02-2021.csv"

url2 <- "https://raw.githubusercontent.com/OpenDataManchester/data/master/themes/Our%20Streets%20Chorlton/Air%20Quality/Four%20Banks%20(163)/Four_Banks_-_Barlow_Moor_Road_(163)_None_07-02-2021_14-02-2021.csv"

url3 <- "https://raw.githubusercontent.com/OpenDataManchester/data/master/themes/Our%20Streets%20Chorlton/Air%20Quality/Four%20Banks%20(163)/Four_Banks_-_Barlow_Moor_Road_(163)_None_15-02-2021_21-02-2021.csv"

four_banks <- read_csv(url(url1)) %>%
  bind_rows(read_csv(url2)) %>%
  bind_rows(read_csv(url3)) %>%
  janitor::clean_names()

head(four_banks)
```

And cleaning them:

```{r ,message=FALSE}

four_banks_cln <- four_banks %>%
  rename(Temperature = four_banks_barlow_moor_road_163_temp_c_slot_b,
         Humidity = four_banks_barlow_moor_road_163_humidity_percent_rh_slot_b,
         NO2 = four_banks_barlow_moor_road_163_no2_ug_m3_slot_b,
         O3 = four_banks_barlow_moor_road_163_o3_ug_m3_slot_b,
         NO = four_banks_barlow_moor_road_163_no_ug_m3_slot_b,
         PM1 = four_banks_barlow_moor_road_163_pm1_ug_m3_slot_b,
         PM2.5 = four_banks_barlow_moor_road_163_pm2_5_ug_m3_slot_b,
         PM10 = four_banks_barlow_moor_road_163_pm10_ug_m3_slot_b,
         Ambient_temp = four_banks_barlow_moor_road_163_ambient_temp_c_slot_b,
         Ambient_humidity = four_banks_barlow_moor_road_163_ambient_humidity_percent_rh_slot_b,
         Ambient_pressure = four_banks_barlow_moor_road_163_ambient_pressure_h_pa_slot_b,
         Timestamp = timestamp_utc) %>%
  mutate(Location = "Four Banks",
         Longitude = -2.277243,
         Latitude = 53.442527) %>%
  select(-timestamp_uts,
         -timestamp_local)

names(darley_avn)

head(four_banks_cln)
```

## Merging data:

The column names are the same so we can now merge the datasets:

```{r}

aq_data <- darley_cln %>%
  bind_rows(four_banks_cln)

head(aq_data)
```

```{r}
summary(aq_data)
```

## Saving data:

And save it as a .csv file:

```{r}
#aq_data %>% write_csv(here::here("Data", "air_quality.csv"))
```

